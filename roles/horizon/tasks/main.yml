- name: install
  yum:
    name: openstack-dashboard

- name: configure
  template:
    src: local_settings.py.j2
    dest: /etc/openstack-dashboard/local_settings
    backup: true
  notify: reload httpd

- name: request certificate
  include_role:
    name: ca
    tasks_from: req_cert.yml
  vars:
    req_name: horizon
    req_common_name: "{{ansible_nodename}}"
    req_owner: apache
    req_group: apache

- name: configure ssl for httpd
  lineinfile:
    path: /etc/httpd/conf.d/ssl.conf
    regexp: "^{{item.regexp}}"
    line: "{{item.line}}"
  loop:
    - regexp: SSLCertificateFile 
      line: "SSLCertificateFile {{req_cert_path}}"
    - regexp: SSLCertificateKeyFile 
      line: "SSLCertificateKeyFile {{req_privatekey_path}}"
  notify: reload httpd

- name: configure httpd
  template:
    src: openstack-dashboard.conf.j2
    dest: /etc/httpd/conf.d/openstack-dashboard.conf
  notify: reload httpd

  # WSGIApplicationGroup %{GLOBAL}
