- name: configure hosts
  template:
    src: hosts.j2
    dest: /etc/hosts

- name: configure provider interface
  lineinfile:
    path: "/etc/sysconfig/network-scripts/ifcfg-{{provider_interface}}"
    line: "{{item.option}}={{item.value}}"
    regexp: "^{{item.option}}"
  loop:
    - option: BOOTPROTO
      value: "none"
    - option: ONBOOT
      value: "yes"
    - option: IPV4_FAILURE_FATAL
      value: "no"
    - option: IPV6INIT
      value: "no"
    - option: IPV6_AUTOCONF
      value: "no"
    - option: IPV6_FAILURE_FATAL
      value: "no"
  when: is_network_node

- name: disable network manager
  systemd:
    name: NetworkManager
    state: stopped
    enabled: false

- name: enable network
  systemd:
    name: network
    state: started
    enabled: true

- name: disable firewalld
  systemd:
    name: firewalld
    state: stopped
    enabled: false
  when: bootstrap_disable_firewalld | bool

- name: add openstack repository
  yum:
    name: "centos-release-openstack-{{bootstrap_openstack_release}}"

# - name: upgrade system
#   yum:
#     name: '*'
#     state: latest

- name: "{{ 'enable' if bootstrap_selinux else 'disable' }} selinux"
  selinux:
    state: "{{ 'enforcing' if bootstrap_selinux else 'permissive' }}"
    policy: targeted

- name: install openstack client and selinux support
  yum:
    name: 
      - python-openstackclient
      - openstack-selinux
